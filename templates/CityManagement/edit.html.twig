{% extends 'Template/StandardTemplate.html.twig' %}
{% import 'Template/Macros/breadcrumb.html.twig' as breadcrumb %}

{% if city != null %}
    {% set title = 'city.management.edit_title'|trans %}
{% else %}
    {% set title = 'city.management.add_title'|trans %}
{% endif %}

{% block title %}{{ title }}{% endblock %}

{% block breadcrumb %}
    {% if city and city.mainSlug %}
        {{ breadcrumb.item(city.city, object_path(city)) }}
        {{ breadcrumb.active(title) }}
    {% else %}
        {{ breadcrumb.item('city.management.breadcrumb_directory'|trans, path('caldera_criticalmass_region_world')) }}
        {% if (region.parent and region.parent.parent and region.parent.parent.parent and not region.parent.parent.parent.isWorld()) %}
            {{ breadcrumb.item(region.parent.parent.parent.name, object_path(region.parent.parent.parent)) }}
        {% endif %}
        {% if (region.parent and region.parent.parent and not region.parent.parent.isWorld()) %}
            {{ breadcrumb.item(region.parent.parent.name, object_path(region.parent.parent)) }}
        {% endif %}
        {% if (region.parent and not region.parent.isWorld()) %}
            {{ breadcrumb.item(region.parent.name, object_path(region.parent)) }}
        {% endif %}
        {{ breadcrumb.item(region.name, object_path(region)) }}
        {{ breadcrumb.active('city.management.breadcrumb_add'|trans) }}
    {% endif %}
{% endblock %}

{% block content %}
    {{ form_errors(form) }}
    <div class="container">
        {{ include('Flash/_flash.html.twig') }}

        {{ form_start(form) }}

        <div class="row">
            <div class="col-md-12">
                <h1>{{ title }}</h1>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div
                        id="map-city"
                        class="map"
                        style="height:250px;"
                        data-controller="map--form-map"
                        data-map--form-map-center-latitude-value="{{ city.latitude }}"
                        data-map--form-map-center-longitude-value="{{ city.longitude }}"
                        data-map--form-map-zoom-value="10"
                        data-map--form-map-marker-latitude-target-value="{{ form.latitude.vars.id }}"
                        data-map--form-map-marker-longitude-target-value="{{ form.longitude.vars.id }}"
                        data-map--form-map-marker-icon-value="fa-university"
                        data-map--form-map-marker-color-value="blue"
                        data-map--form-map-marker-shape-value="circle"
                        data-map--form-map-marker-prefix-value="fas"
                ></div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="row">
                    <div class="col-md-12">
                        <h2>{{ 'city.management.section_city_info'|trans }}</h2>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group{% if form_errors(form.region) %} has-error has-feedback{% endif %}">
                            <label class="control-label" for="">{{ 'city.management.label_region'|trans }}</label>
                            {{ form_widget(form.region, { 'attr' : { 'class': 'form-control'} }) }}
                            <p class="help-block">{{ 'city.management.help_region'|trans }}</p>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group{% if form_errors(form.title) %} has-error has-feedback{% endif %}">
                            <label class="control-label" for="">{{ 'city.management.label_title'|trans }}</label>
                            {{ form_widget(form.title, { 'attr' : { 'class': 'form-control'} }) }}
                            <p class="help-block">{{ 'city.management.help_title'|trans }}</p>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group{% if form_errors(form.city) %} has-error has-feedback{% endif %}">
                            <button class="btn btn-secondary btn-xs pull-right" type="button"
                                data-controller="geocoding"
                                data-action="click->geocoding#search"
                                data-geocoding-query-selector-value="#city_city"
                                data-geocoding-query-part-selector-value="#city_region">
                                <i class="far fa-map-marker"></i>
                            </button>
                            <label class="control-label" for="">{{ 'city.management.label_name'|trans }}</label>
                            {{ form_widget(form.city, { 'attr' : { 'class': 'form-control'} }) }}
                            <p class="help-block">{{ 'city.management.help_name'|trans }}</p>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group{% if form_errors(form.description) %} has-error has-feedback{% endif %}">
                            <label class="control-label" for="">{{ 'city.management.label_description'|trans }}</label>
                            {{ form_widget(form.description, { 'attr' : { 'class': 'form-control', 'rows': '10' } }) }}
                            <p class="help-block">{{ 'city.management.help_description'|trans }}</p>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group{% if form_errors(form.punchLine) %} has-error has-feedback{% endif %}">
                            <label class="control-label" for="">{{ 'city.management.label_punchline'|trans }}</label>
                            {{ form_widget(form.punchLine, { 'attr' : { 'class': 'form-control'} }) }}
                            <p class="help-block">{{ 'city.management.help_punchline'|trans }}</p>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group{% if form_errors(form.longDescription) %} has-error has-feedback{% endif %}">
                            <label class="control-label" for="">{{ 'city.management.label_long_description'|trans }}</label>
                            {{ form_widget(form.longDescription, { 'attr' : { 'class': 'form-control', 'rows': '10' } }) }}
                            <p class="help-block">{{ 'city.management.help_long_description'|trans }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="row">
                    <div class="col-md-12">
                        <h2>{{ 'city.management.section_technical'|trans }}</h2>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label class="control-label" for="">{{ 'city.management.label_enable_board'|trans }}</label>
                            {{ form_widget(form.enableBoard, { 'attr' : { 'class': 'form-control'} }) }}
                            <p class="help-block">{{ 'city.management.help_enable_board'|trans }}</p>
                        </div>
                    </div>
                </div>


                <div class="row">
                    <div class="col-md-12">
                        <h2>{{ 'city.management.section_header_image'|trans }}</h2>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label class="control-label" for="">{{ 'city.management.label_image_file'|trans }}</label>
                            {{ form_widget(form.imageFile, { 'attr' : { 'class': 'form-control'} }) }}
                            <p class="help-block">{{ 'city.management.help_image_file'|trans|raw }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="btn-group pull-right">
                    {% if city and city.mainSlug %}
                        <a href="{{ object_path(city) }}" class="btn btn-secondary">
                            {{ 'common.cancel'|trans }}
                        </a>
                    {% else %}
                        <a href="{{ object_path(region) }}" class="btn btn-secondary">
                            {{ 'common.cancel'|trans }}
                        </a>
                    {% endif %}
                    <button type="submit" class="btn btn-success">
                        {{ 'common.save'|trans }}
                    </button>
                </div>
            </div>
        </div>
        {{ form_end(form) }}
    </div>
{% endblock %}
