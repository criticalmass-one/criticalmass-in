{% extends 'Template/StandardTemplate.html.twig' %}
{% import 'Template/Macros/breadcrumb.html.twig' as breadcrumb %}

{% if ride %}
    {% set title = 'ride.management.edit_title'|trans %}
    {% set mode = 'edit' %}
{% else %}
    {% set title = 'ride.management.create_title'|trans %}
    {% set mode = 'create' %}
{% endif %}

{% block title %}{{ title }}{% endblock %}

{% block breadcrumb %}
    {{ breadcrumb.item('ride.management.breadcrumb_city_list'|trans, path('caldera_criticalmass_city_list')) }}
    {{ breadcrumb.item(city.city, object_path(city)) }}
    {% if ride %}
        {{ breadcrumb.item(ride.title, object_path(ride)) }}
        {{ breadcrumb.active('ride.management.edit_title'|trans) }}
    {% else %}
        {{ breadcrumb.active('ride.management.create_title'|trans) }}
    {% endif %}
{% endblock %}

{% block content %}
    <div class="container">
        {% if city.cycles|length > 0 and mode == 'create' %}
            <div class="row">
                <div class="col-md-12">
                    <div class="alert alert-warning" role="alert">
                        {{ 'ride.management.cycle_warning'|trans|raw }}
                    </div>
                </div>
            </div>

        {% endif %}

        <div class="row">
            <div class="col-md-12">
                <h1>{{ title }}</h1>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <p>{{ 'ride.management.intro'|trans }}</p>
            </div>
        </div>

        {{ include('Flash/_flash.html.twig') }}

        {{ form_start(form) }}
        <div class="row">
            <div class="col-md-12">
                <div id="map"
                     class="map"
                     data-controller="map--form-map"
                     style="height: 250px;"
                     data-map--form-map-center-latitude-value="{{ ride.latitude }}"
                     data-map--form-map-center-longitude-value="{{ ride.longitude }}"
                     data-map--form-map-zoom-value="10"
                     data-map--form-map-marker-latitude-target-value="{{ form.latitude.vars.id }}"
                     data-map--form-map-marker-longitude-target-value="{{ form.longitude.vars.id }}"
                     data-map--form-map-marker-icon-value="fa-bicycle"
                     data-map--form-map-marker-color-value="red"
                     data-map--form-map-marker-shape-value="circle"
                     data-map--form-map-marker-prefix-value="fas">
                </div>
            </div>
        </div>

        <div class="row margin-top-medium">
            <div class="col-md-6">
                <div class="row">
                    <div class="col-md-12">
                        <h3>
                            {{ 'ride.management.section_ride_data'|trans }}
                        </h3>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label class="control-label" for="title">
                                {{ 'ride.management.label_title'|trans }}
                            </label>
                            {{ form_widget(form.title, { 'attr' : { 'class': 'form-control' } }) }}
                            <p class="help-block">
                                {{ 'ride.management.help_title'|trans }}
                            </p>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label class="control-label" for="description">
                                {{ 'ride.management.label_description'|trans }}
                            </label>
                            {{ form_widget(form.description, { 'attr' : { 'class': 'form-control' } }) }}
                            <p class="help-block">
                                {{ 'ride.management.help_description'|trans }}
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="row">
                    <div class="col-md-12">
                        <h3>
                            {{ 'ride.management.section_date_location'|trans }}
                        </h3>
                    </div>
                </div>

                <div class="row" data-controller="ride-date-checker">
                    <div class="col-md-12">
                        <div class="alert alert-warning d-none hidden" role="alert" id="doubleMonthRide" data-ride-date-checker-target="doubleMonthMessage">
                            {{ 'ride.management.warning_double_month'|trans|raw }}
                        </div>

                        <div class="alert alert-danger d-none hidden" role="alert" id="doubleDayRide" data-ride-date-checker-target="doubleDayMessage">
                            {{ 'ride.management.warning_double_day'|trans|raw }}
                        </div>

                        <div class="form-group{% if form_errors(form.dateTime) %} has-error has-feedback{% endif %}">
                            <label class="control-label" for="dateTime">
                                {{ 'ride.management.label_datetime'|trans }}
                            </label>
                            <div class="row">
                                <div class="col-md-6">
                                    {{ form_widget(form.dateTime.date, { attr: { class: 'form-control', 'data-ride-date-checker-target': 'date', 'data-action': 'change->ride-date-checker#checkDate' } }) }}
                                </div>

                                <div class="col-md-6">
                                    {{ form_widget(form.dateTime.time, { attr: { class: 'form-control' } }) }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label class="control-label" for="location">
                                {{ 'ride.management.label_location'|trans }}
                            </label>
                            <button class="btn btn-secondary btn-xs pull-right"
                                    data-controller="geocoding"
                                    data-action="click->geocoding#search"
                                    data-geocoding-query-suffix-value="{{ city.city }},{{ city.region }},{{ city.region.parent }}"
                                    data-geocoding-query-selector-value="#ride_location"
                                    type="button">
                                <i class="far fa-map-marker"></i>
                            </button>
                            {{ form_widget(form.location, { 'attr' : { 'class': 'form-control' } }) }}
                        </div>
                        <p class="help-block">
                            {{ 'ride.management.help_location'|trans }}
                        </p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label class="control-label" for="rideType">
                                {{ 'ride.management.label_ride_type'|trans }}
                            </label>

                            {{ form_widget(form.rideType, { 'attr' : { 'class': 'form-control' } }) }}
                        </div>
                        <p class="help-block">
                            {{ 'ride.management.help_ride_type'|trans }}
                        </p>
                    </div>
                </div>

                {% if form.slug is defined %}
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label" for="slug">
                                    {{ 'ride.management.label_slug'|trans }}
                                </label>

                                {{ form_widget(form.slug, { 'attr' : { 'class': 'form-control' } }) }}
                            </div>
                        </div>
                    </div>
                {% endif %}

                {% if form.enabled is defined %}
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label" for="location">
                                    {{ 'ride.management.label_enabled'|trans }}
                                </label>

                                {{ form_widget(form.enabled, { 'attr' : { 'class': 'form-control' } }) }}
                            </div>
                            <p class="help-block">
                                {{ 'ride.management.help_enabled'|trans }}
                            </p>
                        </div>
                    </div>
                {% endif %}

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <div class="btn-group pull-right" role="group" aria-label="...">
                                {% if ride %}
                                    <a href="{{ object_path(ride) }}" class="btn btn-secondary">
                                        {{ 'common.cancel'|trans }}
                                    </a>
                                {% else %}
                                    <a href="{{ object_path(city) }}" class="btn btn-secondary">
                                        {{ 'common.cancel'|trans }}
                                    </a>
                                {% endif %}
                                <button type="submit" class="btn btn-success" id="rideSubmitButton" data-ride-date-checker-target="submitButton">
                                    {{ 'common.save'|trans }}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {{ form_widget(form.latitude) }}
        {{ form_widget(form.longitude) }}
        {{ form_widget(form._token) }}

        </form>
    </div>
{% endblock %}
