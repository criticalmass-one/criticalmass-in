{% extends 'Template/StandardTemplate.html.twig' %}
{% import 'Template/Macros/breadcrumb.html.twig' as breadcrumb %}

{% set city = ride.city %}

{% block title %}{{ 'gallery.ride_list_title'|trans }}{% endblock %}

{% block breadcrumb %}
    {{ breadcrumb.item('photo.show.breadcrumb_city_list'|trans, path('caldera_criticalmass_city_list')) }}
    {{ breadcrumb.item(ride.city.city, object_path(ride.city)) }}
    {{ breadcrumb.item(ride.title, object_path(ride)) }}
    {{ breadcrumb.active('gallery.ride_list_breadcrumb'|trans) }}
{% endblock %}

{% block content %}
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="btn-group btn-group pull-right" style="margin-top: 16px;">
                    {% if app.user %}
                        {% set uploadPath = object_path(ride, 'caldera_criticalmass_gallery_photos_upload_ride') %}

                        <a class="btn btn-success" href="{{ uploadPath }}" title="{{ 'gallery.ride_list_upload_button'|trans }}">
                            <i class="far fa-camera"></i>
                            {{ 'gallery.ride_list_upload_button'|trans }}
                        </a>
                    {% else %}
                        <button
                                type="button"
                                class="btn btn-success"
                                data-controller="hint-modal"
                                data-modal-hint-title="{{ 'hint_modal.gallery.photo_upload_button.title'|trans }}"
                                data-modal-hint-text="{{ 'hint_modal.gallery.photo_upload_button.text'|trans({'%city%': ride.city.city, '%dateTime%': ride.dateTime|date('d.m.Y')}) }}"
                                data-modal-hint-size="md">
                            <i class="far fa-camera"></i>
                            {{ 'gallery.ride_list_upload_button'|trans }}
                        </button>
                    {% endif %}
                </div>

                <h1>
                    {{ 'gallery.ride_list_heading'|trans({'%ride%': ride.title}) }}
                </h1>
            </div>
        </div>

        {% if pagination|length == 0 %}
            {% if not app.getUser() %}
                <div class="row">
                    <div class="col-md-12">
                        <div class="alert alert-info" role="alert">
                            <strong>
                                {{ 'gallery.ride_list_no_photos_guest_label'|trans }}
                            </strong>
                            {{ 'gallery.ride_list_no_photos_guest'|trans({'%login_url%': path('login')})|raw }}
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="row">
                    <div class="col-md-12">
                        <div class="alert alert-info" role="alert">
                            <strong>
                                {{ 'gallery.ride_list_no_photos_user_label'|trans }}
                            </strong>
                            {{ 'gallery.ride_list_no_photos_user'|trans }}
                        </div>
                    </div>
                </div>
            {% endif %}
        {% else %}
            <div class="row">
                <div class="photo-list">
                    {% for photo in pagination %}
                        <div class="col-xs-6 col-sm-4 col-md-3 col-lg-3">
                            <div class="margin-bottom-medium text-center">
                                <a href="{{ object_path(photo) }}">
                                    {% if photo.posts|length > 0 %}
                                        <span class="badge" style="position: absolute; top: -10px; right: 10px; background-color: red; font-size: 1em;">{{ photo.posts|length }}</span>
                                    {% endif %}
                                    <img class="img-thumbnail"
                                         src="{{ vich_uploader_asset(photo, 'imageFile')|imagine_filter('gallery_photo_thumb') }}"/>
                                </a>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div class="text-center">
                        {{ knp_pagination_render(pagination) }}
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
{% endblock %}
