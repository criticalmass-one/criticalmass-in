{% extends 'CalderaCriticalmassBlogBundle:Template:MasterTemplate.html.twig' %}

{% block title %}{{ post.title }}{% endblock %}


{% set currentPath = url(app.request.attributes.get('_route'), app.request.attributes.get('_route_params')) %}

{% block additionalHeaderElements %}
    <meta property="og:title" content="{{ post.title }}" />
    <meta property="og:type" content="Website" />
    <meta property="og:description" content="{{ post.abstract }}" />
    <meta property="og:url" content="{{ currentPath }}" />
    <meta property="og:locale" content="de_DE" />
    <meta property="og:site_name" content="{{ blog.hostname }}" />
    {% if post.featuredPhoto %}
        <meta property="og:image" content="{{ vich_uploader_asset(post.featuredPhoto, 'imageFile')|imagine_filter('blog_featuredphoto_standard') }}" />
    {% endif %}
{% endblock %}

{% block content %}
<div class="blog-view blog container m-t-3">
    <div class="row">
        <div class="col-xs-12 text-xs-center">
            <h1 class="display-2">
                <a href="{{ path(routes.blogHomepage) }}">
                    {{ blog.title }}
                </a>
            </h1>

            <p class="lead">
                {{ blog.description }}
            </p>
        </div>
    </div>

    <div class="row m-t-3">
        <div class="col-xs-12">
            <header style="background-image: url({{ vich_uploader_asset(post.featuredPhoto, 'imageFile')|imagine_filter('blog_featuredphoto_standard') }});">

            </header>
        </div>
    </div>
    <div class="row m-t-3">
        <div class="col-xs-12 col-sm-10 offset-sm-1">
            <div class="row">
                <div class="row m-t-3">
                    <div class="col-xs-12 col-sm-10 text-xs-center">
                        {% if post.claim %}
                            <p class="m-b-0">
                                {{ post.claim }}
                            </p>
                        {% endif %}

                        <h2>
                            {{ post.title }}
                        </h2>
                    </div>
                </div>
            </div>

            <div class="row m-t-2">
                <div class="col-xs-12 col-sm-10">
                    <article>
                        {{ post.text | parse }}
                    </article>
                </div>

                <div class="hidden-xs-down col-sm-2">
                    <div class="row">
                        <div class="col-sm-12 text-sm-center">
                            <img src="{{ gravatarUrl(post.user, 256) }}" class="img-circle img-fluid" />
                        </div>
                    </div>

                    <div class="row m-t-2">
                        <div class="col-sm-12 text-sm-center">
                            {{ post.user.username }}
                            <br />
                            {{ post.dateTime | date('d.m.Y') }}
                        </div>
                    </div>

                    {% if post.showCoffeeButton %}
                    <div class="row m-t-2">
                        <div class="col-sm-12 text-sm-center">
                            <div class="btn-group btn-group-sm" role="group" aria-label="Buy me a coffee">
                                <a class="btn btn-secondary" href="https://ko-fi.com/A538AMI">
                                    <i class="fa fa-coffee" aria-hidden="true"></i>
                                    Coffee
                                </a>
                                <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#coffeeModal">
                                    <i class="fa fa-question" aria-hidden="true"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    {% if post.cities | length > 0 %}
                    <div class="row m-t-3">
                        <div class="col-xs-12 text-xs-center">
                            <p>
                                Tags:
                            </p>

                            <ul class="list-unstyled">
                            {% for city in post.cities %}
                                <li>
                                    <a href="{{ path(city) }}">
                                        #{{ city.slug }}
                                    </a>
                                </li>
                            {% endfor %}
                            </ul>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            {% if post.showCoffeeButton %}
            <div class="row m-t-3">
                <div class="col-xs-12 text-xs-center">
                    <div class="btn-group" role="group" aria-label="Buy me a coffee">
                        <a class="btn btn-secondary" href="https://ko-fi.com/A538AMI">
                            <i class="fa fa-coffee" aria-hidden="true"></i>
                            Buy Me a Coffee
                        </a>
                        <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#coffeeModal">
                            <i class="fa fa-question" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>
            </div>
            {% endif %}

            <div class="row m-t-3">
                <a name="comments"></a>
                <div class="col-md-12">
                    <h3>
                        Kommentare zu diesem Beitrag
                    </h3>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    {{ render(controller('CalderaCriticalmassBlogBundle:Comment:list', { 'blogPost': post })) }}
                </div>
            </div>

            {% if app.user and post.commentsEnabled %}
            {{ render(controller('CalderaCriticalmassBlogBundle:Comment:write', { 'blogPost': post })) }}
            {% elseif not app.user %}
            <div class="alert alert-info" role="alert">
                Bitte <a href="#" data-toggle="modal" data-target="#loginModal">logge dich ein</a> oder <a href="{{ path('fos_user_registration_register') }}">registriere dich</a>, um einen Kommentar zu verfassen &mdash; es dauert nicht einmal 30 Sekunden!
            </div>
            {% elseif not post.commentsEnabled %}
            <div class="alert alert-warning" role="alert">
                Schade &mdash; zu diesem Beitrag können leider keine Kommentare geschrieben werden.
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="coffeeModal" tabindex="-1" role="dialog" aria-labelledby="coffeeModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="coffeeModalLabel">Kaffee?</h4>
            </div>
            <div class="modal-body">
                <p>
                    Das Betreiben mehrerer Webseiten und Weblogs kostet eine Menge Zeit und Geld. Das ist okay, schließlich ist es ein Hobby und ein bisschen Leidenschaft steckt auch dahinter. Trotzdem ist die Sache mit dem Geld manchmal echt lästig &mdash; beispielsweise habe ich bei der Critical Mass Hamburg schon zwei teure Spiegelreflexkameras im Regen verschlissen (<a href="https://criticalmass.photos/hamburg/2013-07-26">Juli 2013</a> und <a href="https://criticalmass.photos/hamburg/2016-07-29">Juli 2016</a>), vom überdurchschnittlichen Verschleiß am Fahrrad mal ganz zu schweigen.
                </p>

                <p>
                    Ich will und werde dafür auch in Zukunft kein Geld verlangen. Beim Programmieren, Schreiben und Fotos sortieren sitze ich gerne irgendwo in einem Café oder in einem Park, aber die Getränke sind da echt teuer. Aber wenn du willst, kannst du mir einen Kaffee spendieren &mdash; das wäre echt super-cool!
                </p>
            </div>
            <div class="modal-footer">
                <div class="btn-group">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">
                        <i class="fa fa-times" aria-hidden="true"></i>
                        Nee, sorry
                    </button>
                    <a href="https://ko-fi.com/A538AMI" class="btn btn-primary">
                        <i class="fa fa-coffee" aria-hidden="true"></i>
                        Klingt geil
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
